# PostgreSQL

## **COMMANDS**

### `psql` Commands

`psql` is a command-line interface for interacting with PostgreSQL databases. It allows you to execute SQL commands and view the results, create and modify database objects, and manage database users and permissions.

| Commands             | Details                          | Example                    |
| -------------------- | -------------------------------- | -------------------------- |
| `-U <username>`      | Connecting as a specific use     | `psql -U postgres`         |
| `-d <database_name>` | Connecting to database           | `psql -d animals`          |
| `-h <host_name>`     | Connecting to a host             | `psql -h localhost`        |
| `-p <port_name>`     | Connecting to a port             | `psql -p 1222`             |
| `-f`                 | Execute commands from a file     | `psql animals -f file.sql` |
| `-t`,`--tuples-only` | Print rows only                  | `psql -U -t`               |
| `-x`,`--expanded`    | Turn on expanded table output    | `psql -U -d -x`            |
| `-c`,`--command`     | Run only single command and exit | `psql -c -U -d`            |

### PostgreSQL Commands

| Commands             | scope    | Details                         |
| -------------------- | -------- | ------------------------------- |
| `\c <database_name>` | database | Connect to new database         |
| `\conninfo`          | database | Display information             |
| `\l`                 | database | List all databases              |
| `\l+`                | database | List all databases with details |
| `\d <table_name>`    | table    | Describe table                  |
| `\d+ <table_name>`   | table    | Describe table with details     |
| `\dt`                | table    | List tables from current schema |
| `\dT`                | table    | Show all user-defined types     |
| `\dt *.*`            | table    | List tables from all schemas    |
| `\dp`                | table    | List table access privileges    |
| `\! clear`           | global   | Clear screen                    |

### Useful commands line

#### Use `pg_dumpall` to backup all databases

```sql
pg_dumpall -U postgres > universe.sql
```

#### Use `pg_dump` to backup a database

```sql
-- syntax --
pg_dump -d <database_to_be_saved> -f planets.sql

pg_dump -d planets -f planets.sql

-- `-a` Dump only the data, not the schema
-- `-s` Dump only the schema, no data
-- `-c` Drop database before recreating
-- `-C` Create database before restoring
-- `-t` Dump the named table(s) only
```

#### Restore a database with `psql`

```sql
-- syntax --
psql -U <username> <database_to_be_restored> < <backup_database>

psql -U postgres planets < planets.sql
```

#### Restore a database with `pg_restore`

```sql
-- syntax --
psql -U <username> -d <database_to_be_restored> <backup_database> -c

psql -U postgres planets planets.sql -c

-- `-U` Specify a database user
-- `-c` Drop database before recreating
-- `-C` Create database before restoring
-- `-e` Exit if an error has encountered
-- `-F` Format (c: custom, d: directory, t: tar, p: plain text sql(default)
```

## 🧨 **DATATYPE**

PostgreSQL offers a wide range of data types to choose from when designing your database tables. From basic types like `integers` and `characters` to more specialized types like `JSON` and `UUID`, PostgreSQL has a data type to suit almost any need.

```SQL
-- syntax --
ALTER TABLE <table_name> ADD COLUMN <column_name> DATA TYPE;

-- example --
ALTER TABLE users ADD COLUMN username VARCHAR(30);

-- change data type --
ALTER TABLE <table_name> ALTER COLUMN <column_name> SET DATA TYPE <new_data_type>;

ALTER TABLE users ADD COLUMN username VARCHAR(99);
```

| Name             | typw    | Description                                          | syntax                   |
| ---------------- | ------- | ---------------------------------------------------- | ------------------------ |
| `SERIAL`         | Numeric | Auto-incrementing integer.                           | `... SERIAL`             |
| `INTEGER`, `INT` | Numeric | Stores integer values.                               | `...age INT`             |
| `SMALLINT`,      | Numeric | Signed two-byte integer.                             | ``                       |
| `NUMERIC(p,s)`,  | Numeric | Stores numbers with a fixed `precision` and `scale`. | `...price NUMERIC(10,2)` |
| `DECIMAL(p,s)`,  | Numeric | ''                                                   | ``                       |
| `VARCHAR(n)`     | char    | Variable-length character string                     | `...VARCHAR(255)`        |
| `text`           | char    | Variable unlimited length                            | ``                       |
| `BOOLEAN` `BOOL` | bool    | Logical Boolean (true/false)                         | `... BOOL`               |
| `DATE`           | date    | Calendar date (year, month, day)                     | `... DATE`               |
| `TIMESTAMP`      | date    | Date and time (no time zone)                         | ``                       |
| `uuid`           | ''      | Universally unique identifier                        | ``                       |
| `json`           | ''      | Textual JSON data                                    | ``                       |

### Enumerated Types `ENUM`

```sql
-- syntax --
CREATE TYPE <enum_name> AS ENUM (<enum_values>);

-- examples --
CREATE TYPE user_status AS ENUM ('Active', 'Inactive', 'Blocked');

-- Rename Enum
ALTER TYPE <old_enum_name> RENAME TO <new_enum_name>
ALTER TYPE user_status RENAME TO user_login_status

-- View All Enum values
SELECT * FROM pg_enum;
-- View All Enum values from specific type
SELECT * FROM pg_enum WHERE enumtypid = '<enum_name>'::regtype ;


-- Add Enum values
ALTER TYPE <enum_name> ADD VALUE '<value>'

ALTER TYPE <enum_name> ADD VALUE '<value>' AFTER '<stored_value>'


-- Rename enum values
ALTER TYPE <enum_name> RENAME VALUE  '<old_value>' TO '<new_value>'

ALTER TYPE user_status RENAME VALUE 'Inactive' to 'In-Active'

-- Drop Enum Type--
DROP TYPE <enum_name>;

DROP TYPE user_status;

-- Drop a Enum Value
DELETE FROM pg_enum WHERE enumtypid = '<enum_name>'::regtype AND enumlabel = '<enum_value_to_delete>'

DELETE FROM pg_enum WHERE enumtypid = 'user_status'::regtype AND enumlabel = 'In-Active'
```

## 💪 **CONSTRAINT**

### Syntax

```sql

-- Example with create table --
CREATE TABLE users (
   id   INT PRIMARY KEY,
   username VARCHAR(33) UNIQUE NOT NULL,
   profile  INT REFERENCES profiles(profile_id)
   age CHECK(age >= 18)
   status VARCHAR(55) DEFAULT 'Active'
);

-- With desire constraint name --

ALTER TABLE <table_name> add CONSTRAINT <constraint_name> CONSTRAINT;

ALTER TABLE  users add CONSTRAINT valid_age CHECK(age >= 18);
ALTER TABLE  articles add CONSTRAINT article_primary_key PRIMARY KEY(article_id, article_author);

-- Rename constraint name --

ALTER TABLE <table_name> RENAME CONSTRAINT <old_constraint_name> TO <new_constraint_name>;

ALTER TABLE articles RENAME CONSTRAINT author_title to compkey_author_title;

-- drop --
ALTER TABLE <table_name> DROP CONSTRAINT <CONSTRAINT_NAME>;

ALTER TABLE users DROP CONSTRAINT users_age_check;
```

### `CHECK()`

A combination of a NOT NULL and UNIQUE constraint, used to identify each row in a table.

```sql
-- syntax --
ALTER TABLE <table_name> ADD COLUMN <column_name> <DATA_TYPE> <CONSTRAINT> CHECK( <column_name> <condition>) ;

-- example --
ALTER TABLE users ADD COLUMN age INT NOT NULL CHECK( age >= 18 );

ALTER TABLE  users add CONSTRAINT valid_age CHECK(age >= 18)

...CHECK (status IN ('Active', 'Inactive'))
...CHECK (grade >= 0 AND grade <= 100),
...CHECK (date_of_birth < NOW()),

-- drop --
ALTER TABLE <table_name> DROP CONSTRAINT <CONSTRAINT_NAME>;

ALTER TABLE users DROP CONSTRAINT users_age_check;
```

### `NOT NULL`

Ensures that a column cannot contain a null value.

```sql
-- syntax --
ALTER TABLE <table_name> ADD COLUMN <column_name> <DATA_TYPE> NOT NULL;

-- examples --
ALTER TABLE users ADD COLUMN username VARCHAR(33) NOT NULL;

ALTER TABLE users ALTER COLUMN username SET NOT NULL;

-- drop --
ALTER TABLE <table_name> ALTER COLUMN <column_name> DROP NOT NULL ;

ALTER TABLE users ALTER COLUMN username DROP NOT NULL ;
```

### `UNIQUE`

Ensures that the values in a column or set of columns are unique across all rows in the table.

```sql
-- syntax --
ALTER TABLE <table_name> ADD COLUMN <column_name> <DATA_TYPE> UNIQUE ;

ALTER TABLE <table_name> ADD UNIQUE(<column_name>) ;

-- examples --
ALTER TABLE users ADD COLUMN username VARCHAR(33) UNIQUE ;

ALTER TABLE users ADD UNIQUE(username) ;

-- drop --
ALTER TABLE <table_name> DROP CONSTRAINT <CONSTRAINT_NAME>;

ALTER TABLE users DROP CONSTRAINT users_username_key;
```

Add the `UNIQUE` constraint to the column you just added.

### `PRIMARY KEY()`

A combination of a NOT NULL and UNIQUE constraint, used to identify each row in a table.

```sql
-- syntax --
ALTER TABLE <table_name> ADD PRIMARY KEY(<column_name>);

-- examples --
ALTER TABLE users ADD PRIMARY KEY(username) ;

-- drop --
ALTER TABLE <table_name> DROP CONSTRAINT <CONSTRAINT_NAME>;

ALTER TABLE users DROP CONSTRAINT users_pkey;
```

**Composite `PRIMARY KEY()`**

A composite primary key, also known as a compound primary key, is a primary key that consists of two or more columns. It is used to uniquely identify each row in a table when the primary key cannot be determined by a single column.

```sql
-- syntax --
ALTER TABLE <table_name> ADD PRIMARY KEY(<column_name>,<column_name>,...) ;

-- examples --
ALTER TABLE articles ADD PRIMARY KEY(title, author) ;

ALTER TABLE articles ADD CONSTRAINT compkey_title_author PRIMARY KEY(title, author)

-- drop --
ALTER TABLE <table_name> DROP CONSTRAINT <CONSTRAINT_NAME>;

ALTER TABLE users DROP CONSTRAINT users_pkey;
```

### `FOREIGN KEY()`

Ensures that the values in a column (or set of columns) match the values in a column (or set of columns) in another table.

```sql
-- syntax --
ALTER TABLE <table_name> ADD COLUMN <column_name> FOREIGN KEY (<column_name>) REFERENCES <table_name>(<column_name>)

ALTER TABLE <table_name> ADD FOREIGN KEY (<column_name>) REFERENCES <table_name>(<column_name>)

-- examples --
ALTER TABLE profiles ADD COLUMN user_id int REFERENCES users(user_id)

ALTER TABLE profiles ADD FOREIGN KEY(stat_id) REFERENCES statistics(stat_id)

-- drop --
ALTER TABLE <table_name> DROP CONSTRAINT <CONSTRAINT_NAME>;

ALTER TABLE users DROP CONSTRAINT profile_uname_fkey;
```

### `DEFAULT`

is a constraint that specifies a default value for a column. If no value is specified for the column when a new row is inserted, the default value will be used.

```sql
-- syntax --
ALTER TABLE <table_name> ALTER COLUMN <column_name> SET DEFAULT <value> ;

-- examples --
ALTER TABLE users ALTER COLUMN name SET DEFAULT 'Anonymous' ;

-- drop --

ALTER TABLE profiles ALTER COLUMN name DROP DEFAULT;
```

### `EXCLUDE`

_not yet learn_

### `DEFERRABLE`

_not yet learn_

### `INITIALLY DEFERRED`

_not yet learn_

## 🚀 **DATABASE**

```sql
-- List of all databases
\l

-- Connect to a database.
\c <database_name>

\c users

-- Show current database
SELECT current_database();

-- Create new database
CREATE DATABASE <database_name>;

CREATE DATABASE users ;

--- Rename a database
ALTER DATABASE <old_database_name> RENAME TO <new_database_name>;

ALTER DATABASE user RENAME TO users;

-- Drop database
DROP DATABASE <database_name>;
DROP DATABASE IF EXISTS <database_name>;

DROP DATABASE users ;
DROP DATABASE IF EXISTS users;

```

## 🏭 **DATA DEFINITION**

### Modifying Tables

```sql
-- Display the tables.
\d
\d <table_name>

-- Create tables
CREATE TABLE <table_name>();
CREATE TABLE <table_name>(<column_name> DATATYPE CONSTRAINT, ...);

CREATE TABLE user(username VARCHAR(30) UNIQUE PRIMARY KEY,...);

-- Rename Table
ALTER TABLE <table_name> RENAME TO <new_table_name> ;

ALTER TABLE user RENAME TO users ;

-- Drop Table
DROP TABLE <table_name>;

DROP TABLE users;

-- Constraint
ALTER TABLE users ADD UNIQUE(username);
ALTER TABLE users ADD PRIMARY KEY(username) ;
ALTER TABLE users ADD CONSTRAINT valid_age CHECK(age >= 18) ;
ALTER TABLE profiles ADD FOREIGN KEY(stat_id) REFERENCES statistics(stat_id)

ALTER TABLE <table_name> DROP CONSTRAINT <CONSTRAINT_NAME>;
```

#### Modifying Columns

```sql
--- Add columns
ALTER TABLE <table_name> ADD COLUMN <column_name> DATATYPE CONSTRAINT;

ALTER TABLE users ADD COLUMN username VARCHAR(30) UNIQUE NOT NULL;

-- Rename column
ALTER TABLE <table_name> RENAME COLUMN <old_column_name> TO <new_column_name>;

ALTER TABLE persons RENAME COLUMN name TO username;

-- Drop columns
ALTER TABLE <table_name> DROP COLUMN <column_name>;

ALTER TABLE profiles DROP COLUMN bio;

-- Change Data Type

ALTER TABLE <table_name> ALTER COLUMN <column_name> TYPE <NEW_DATA_TYPE>;
ALTER TABLE profiles ALTER COLUMN bio TYPE TEXT;


-- Constraint
ALTER TABLE profiles ALTER COLUMN gender SET NOT NULL;
ALTER TABLE profiles ALTER COLUMN bio SET DEFAULT '';

ALTER TABLE profiles ALTER COLUMN bio DROP DEFAULT;
```

### Primary Key

```sql
-- Next, you are going to add a primary key. It's a column that uniquely identifies each row in the table. Here's an example of how to set a PRIMARY KEY:

ALTER TABLE table_name ADD PRIMARY KEY(column_name);

ALTER TABLE persons ADD PRIMARY KEY(nid);

-- Here's an example of how to drop a constraint:
ALTER TABLE table_name DROP CONSTRAINT constraint_name;

ALTER TABLE characters DROP CONSTRAINT characters_pkey;

-- To know what row a character is for, you need to set a foreign key so you can relate rows from this table to rows from your characters table. Here's an example that creates a column as a foreign key:

ALTER TABLE table_name ADD COLUMN column_name DATATYPE REFERENCES referenced_table_name(referenced_column_name);

ALTER TABLE additional_info ADD COLUMN character_id DATATYPE REFERENCES characters(character_id);

-- You can set an existing column as a foreign key like this:

ALTER TABLE table_name ADD FOREIGN KEY(column_name) REFERENCES referenced_table(referenced_column);

ALTER TABLE additional_info ADD FOREIGN KEY(character_id) REFERENCES characters(character_id);
```

### Relationships

```sql
-- These tables have a "one-to-one" relationship. One row in the characters table will be related to exactly one row in more_info and vice versa. Enforce that by adding the UNIQUE constraint to your foreign key.

ALTER TABLE table_name ADD UNIQUE(column_name);

---

ALTER TABLE table_name ADD COLUMN column_name DATATYPE CONSTRAIN REFERENCES referenced_table_name(referenced_column_name);

ALTER TABLE additional_info ADD COLUMN character_id VARCHAR(30) UNIQUE REFERENCES characters(character_id);

```

```sql
-- This will be a "one-to-many" relationship because one character will have many sounds, but no sound will have more than one character. Here's the example again:

ALTER TABLE table_name ADD COLUMN column_name DATATYPE CONSTRAINT REFERENCES referenced_table_name(referenced_column_name);
```

```sql
-- "Many-to-many" relationships usually use a junction table to link two tables together, forming two "one-to-many" relationships.

```

## 💾 DATA MANIPULATION

### Inserting Data

```sql
-- Rows are the actual data in the table. You can add one like this

INSERT INTO table_name(column_1, column_2) VALUES(value1, value2);

INSERT INTO persons(id,username) VALUES(1,'Sizar');

-- Update Multiple row/data at the same time

INSERT into persons(name,homeland,favorite_color) values('Toadstool','Mushroom Kingdom','Red'),('Bowser','Mushroom Kingdom','Green');

```

### Updating Data

```sql
--- You can change a value like this:
UPDATE table_name SET column_name=new_value WHERE CONDITIONS;

UPDATE characters SET favorite_color='Orange' WHERE name='Daisy';

```

### Deleting Data

```sql
-- Here's an example of how to delete a row.

DELETE FROM table_name WHERE CONDITIONS;

DELETE FROM persons WHERE username='Sizar';
```

## 💻 QUERIES

```sql
-- You can view the data in a table by querying it with the `SELECT` statement. Here's how it looks:

SELECT columns FROM table_name;

-- Use an asterisk `*` to denote that you want to see all the columns.

SELECT * FROM table_name;
```

### Projecting Data / Rearranging

```sql
-- Actually, you should put that in order. Here's an example:

SELECT columns FROM table_name ORDER BY column_name;

SELECT * FROM persons ORDER BY country;
```

## 💑 JOIN

```

```
